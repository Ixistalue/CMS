<!DOCTYPE html>
<html lang="uk">
<head>
    <link rel="manifest" href="manifest.json">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Форма для додавання та редагування студентів</title>
    <link rel="manifest" href="manifest.json"> <!-- Маніфест для PWA -->
    <script src="app.js" defer></script> <!-- Підключення JS -->
    <style>
        .error { border: 2px solid red; }
        .error-message { color: red; font-size: 0.9em; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px; background-color: white; border: 1px solid #ccc; z-index: 1000; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 500; }
    </style>
</head>
<body>
    <button onclick="openForm()">Додати студента</button>

    <!-- Модальне вікно -->
    <div class="overlay" id="overlay"></div>
    <div class="modal" id="modal">
        <h2 id="form-title">Додати студента</h2>
        <form id="student-form">
            <input type="hidden" id="student-id">

            <label for="name">Ім'я:</label>
            <input type="text" id="name" required pattern="[A-Za-zА-Яа-яЁёіІєЄ]+">
            <div class="error-message" id="name-error"></div>

            <label for="email">Email:</label>
            <input type="email" id="email" required>
            <div class="error-message" id="email-error"></div>

            <label for="age">Вік:</label>
            <input type="number" id="age" required min="18" max="100">
            <div class="error-message" id="age-error"></div>

            <button type="submit">Зберегти</button>
        </form>
    </div>

    <!-- Таблиця для відображення студентів -->
    <table id="students-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Ім'я</th>
                <th>Email</th>
                <th>Вік</th>
                <th>Дії</th>
            </tr>
        </thead>
        <tbody>
            <!-- Тут будуть відображатися студенти -->
        </tbody>
    </table>

    <script>
        // Оголошення масиву студентів
        let students = [];

        // Функція для відкриття форми
        function openForm(student = null) {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('modal').style.display = 'block';

            if (student) {
                document.getElementById('form-title').textContent = 'Редагувати студента';
                document.getElementById('student-id').value = student.id;
                document.getElementById('name').value = student.name;
                document.getElementById('email').value = student.email;
                document.getElementById('age').value = student.age;
            } else {
                document.getElementById('form-title').textContent = 'Додати студента';
                document.getElementById('student-id').value = '';
                document.getElementById('name').value = '';
                document.getElementById('email').value = '';
                document.getElementById('age').value = '';
            }
        }

        // Функція для закриття форми
        function closeForm() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('modal').style.display = 'none';
        }

        // Валідація форми
        function validateForm() {
            let isValid = true;
            // Перевірка імені
            const name = document.getElementById('name');
            const nameError = document.getElementById('name-error');
            if (!name.value.match(/[A-Za-zА-Яа-яЁёіІєЄ]+/)) {
                name.classList.add('error');
                nameError.textContent = 'Ім\'я має бути валідним.';
                isValid = false;
            } else {
                name.classList.remove('error');
                nameError.textContent = '';
            }

            // Перевірка email
            const email = document.getElementById('email');
            const emailError = document.getElementById('email-error');
            if (!email.validity.valid) {
                email.classList.add('error');
                emailError.textContent = 'Email має бути валідним.';
                isValid = false;
            } else {
                email.classList.remove('error');
                emailError.textContent = '';
            }

            // Перевірка віку
            const age = document.getElementById('age');
            const ageError = document.getElementById('age-error');
            if (age.value < 18 || age.value > 100) {
                age.classList.add('error');
                ageError.textContent = 'Вік має бути між 18 та 100 роками.';
                isValid = false;
            } else {
                age.classList.remove('error');
                ageError.textContent = '';
            }

            return isValid;
        }

        // Обробка сабміту форми
        document.getElementById('student-form').addEventListener('submit', function (event) {
            event.preventDefault();

            if (!validateForm()) return;

            const id = document.getElementById('student-id').value;
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const age = document.getElementById('age').value;

            // Якщо є ID, то редагуємо студента, інакше додаємо нового
            if (id) {
                const student = students.find(s => s.id == id);
                student.name = name;
                student.email = email;
                student.age = age;
            } else {
                const newStudent = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    age: age
                };
                students.push(newStudent);
            }

            // Оновлення таблиці та виведення JSON в консоль
            updateTable();
            console.log(JSON.stringify(students));

            closeForm();
        });

        // Оновлення таблиці
        function updateTable() {
            const tableBody = document.getElementById('students-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            students.forEach(student => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.email}</td>
                    <td>${student.age}</td>
                    <td><button onclick="openForm(${JSON.stringify(student)})">Редагувати</button></td>
                `;
            });
        }
        if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js').then(registration => {
    console.log('Service Worker registered with scope:', registration.scope);
  }).catch(error => {
    console.log('Service Worker registration failed:', error);
  });
}

    </script>
</body>
</html>
